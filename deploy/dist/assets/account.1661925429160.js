import{$ as w,_ as D,d as $,I as A,H as y,j as E,D as N,k as M,a3 as j,m as z,c as O,a as H,h as o,w as s,F as J,a1 as G,r as n,o as K,b as d,B as L,t as Q,S as W,a4 as X,a5 as Y,M as Z,g as ee}from"./index.1661925429160.js";import{D as oe}from"./dragVerifyImgRotate.1661925429160.js";function ae(){return w({url:"/system/user/getCaptcha",method:"get"})}function se(p){return w({url:"/system/user/login",method:"post",data:p})}const te={class:"login-content-code"},ne=["src"],le=$({__name:"account",setup(p){const{t:V}=A(),{proxy:I}=ee(),f=y(null),_=y(null),m=E(),h=N(),e=M({dialogVerifyVisible:!1,isPassingFour:!1,imgThree:j,captchaImage:"",loginForm:{username:"admin",password:"123456",captcha:"",captchaId:""},rules:{username:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:"blur"}],password:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801",trigger:"blur"}],captcha:[{required:!0,message:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",trigger:"blur"}]},isShowPassword:!1,loading:{signIn:!1}});z(()=>{g()});const g=async()=>{let t=await ae();e.captchaImage=t.base64Captcha,e.loginForm.captchaId=t.captchaId},C=O(()=>G(new Date)),x=()=>{f.value.validate(t=>{if(t)b();else return!1})},b=async()=>{e.loading.signIn=!0;let t;try{t=await se(e.loginForm)}catch{_.value.reset(),e.isPassingFour=!1,e.loading.signIn=!1,e.loginForm.captcha="",g();return}let a=t.data;W.set("token",a.token),X.set("userName",e.loginForm.username),await Y(),B()},P=()=>{e.dialogVerifyVisible=!0},k=()=>{e.dialogVerifyVisible=!1,e.isPassingFour=!1,x()},B=()=>{var a,c,i,r;let t=C.value;(a=m.query)!=null&&a.redirect?h.push({path:(c=m.query)==null?void 0:c.redirect,query:Object.keys((i=m.query)==null?void 0:i.params).length>0?JSON.parse((r=m.query)==null?void 0:r.params):""}):h.push("/"),setTimeout(()=>{e.loading.signIn=!0;const u=V("message.signInText");Z.success(`${t}\uFF0C${u}`),I.mittBus.emit("onSignInClick")},300)};return(t,a)=>{const c=n("elementUser"),i=n("el-icon"),r=n("el-input"),u=n("el-form-item"),v=n("elementUnlock"),S=n("elementPosition"),F=n("el-col"),R=n("el-row"),T=n("el-button"),U=n("el-form"),q=n("el-dialog");return K(),H(J,null,[o(U,{ref_key:"loginFormRef",ref:f,size:"large",model:e.loginForm,rules:e.rules,class:"login-content-form"},{default:s(()=>[o(u,{class:"login-animation-one"},{default:s(()=>[o(r,{type:"text",placeholder:t.$t("message.account.accountPlaceholder1"),modelValue:e.loginForm.username,"onUpdate:modelValue":a[0]||(a[0]=l=>e.loginForm.username=l),clearable:"",autocomplete:"off"},{prefix:s(()=>[o(i,{class:"el-input__icon"},{default:s(()=>[o(c)]),_:1})]),_:1},8,["placeholder","modelValue"])]),_:1}),o(u,{class:"login-animation-two"},{default:s(()=>[o(r,{type:e.isShowPassword?"text":"password",placeholder:t.$t("message.account.accountPlaceholder2"),modelValue:e.loginForm.password,"onUpdate:modelValue":a[2]||(a[2]=l=>e.loginForm.password=l),autocomplete:"off"},{prefix:s(()=>[o(i,{class:"el-input__icon"},{default:s(()=>[o(v)]),_:1})]),suffix:s(()=>[d("i",{class:L(["iconfont el-input__icon login-content-password",e.isShowPassword?"icon-yincangmima":"icon-xianshimima"]),onClick:a[1]||(a[1]=l=>e.isShowPassword=!e.isShowPassword)},null,2)]),_:1},8,["type","placeholder","modelValue"])]),_:1}),o(u,{class:"login-animation-three"},{default:s(()=>[o(R,{gutter:15},{default:s(()=>[o(F,{span:16},{default:s(()=>[o(r,{type:"text",maxlength:"6",placeholder:t.$t("message.account.accountPlaceholder3"),modelValue:e.loginForm.captcha,"onUpdate:modelValue":a[3]||(a[3]=l=>e.loginForm.captcha=l),clearable:"",autocomplete:"off"},{prefix:s(()=>[o(i,{class:"el-input__icon"},{default:s(()=>[o(S)]),_:1})]),_:1},8,["placeholder","modelValue"])]),_:1}),o(F,{span:8},{default:s(()=>[d("div",te,[d("img",{class:"login-content-code-img",onClick:g,width:"130px",height:"38px",src:e.captchaImage,style:{cursor:"pointer"}},null,8,ne)])]),_:1})]),_:1})]),_:1}),o(u,{class:"login-animation-four"},{default:s(()=>[o(T,{type:"primary",class:"login-content-submit",round:"",onClick:P,loading:e.loading.signIn},{default:s(()=>[d("span",null,Q(t.$t("message.account.accountBtnText")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"]),o(q,{modelValue:e.dialogVerifyVisible,"onUpdate:modelValue":a[5]||(a[5]=l=>e.dialogVerifyVisible=l),title:"\u65CB\u8F6C\u9A8C\u8BC1\u7801",width:"300px",center:""},{default:s(()=>[o(oe,{ref_key:"dragRef",ref:_,imgsrc:e.imgThree,isPassing:e.isPassingFour,"onUpdate:isPassing":a[4]||(a[4]=l=>e.isPassingFour=l),text:"\u8BF7\u6309\u4F4F\u6ED1\u5757\u62D6\u52A8",successText:"\u9A8C\u8BC1\u901A\u8FC7",handlerIcon:"fa fa-angle-double-right",successIcon:"fa fa-hand-peace-o",onPasscallback:k},null,8,["imgsrc","isPassing"])]),_:1},8,["modelValue"])],64)}}});var ue=D(le,[["__scopeId","data-v-6abae41a"]]);export{ue as default};
